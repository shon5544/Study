#ip

### 출처
* https://ko.wikipedia.org/wiki/%EC%9D%B8%ED%84%B0%EB%84%B7_%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C (ip란)
* https://ko.wikipedia.org/wiki/ARP_%EC%8A%A4%ED%91%B8%ED%95%91 (arp 스푸핑)
___
### 개요
* [[#IP란]]
* [[#IP 주소]]
* [[#IP 클래스]]
* [[#서브네팅과 서브넷 마스크]]
___
### IP란

<span class="red red-bg">ip는 인터넷을 사용하기 위해 지켜야할 통신 규약이다. 패킷을 라우팅하고 ip주소를 지정하는 규칙들이 여기에 포함된다. </span> **ip는 패킷을 올바른 위치에 보내는 것 까지만 신경쓰고** 해당 패킷을 어떻게 처리할지는 이 위의 전송 계층에서 처리한다.

<span class="red red-bg">ip는 신뢰성을 갖지 않는다. 이에 따라 전송과정에서 패킷이 손상되거나 순서가 꼬이는 현상이 발생할 수 있다.</span> 따라서 신뢰성을 보장하고 싶다면, 전송계층에서 처리해야 한다. 초기 인터넷은 신뢰성을 보장하기 위해 수행해야 하는 사전 작업의 오버헤드가 컸기 떄문에 신뢰성을 보장하지 않는 방식으로 설계 됐다.
___
### IP 주소

* **IPv4**
	<span class="red red-bg">IPv4는 32비트 주소 체계를 사용하며, (0~255) 범위의 네 개의 숫자로 구성된다.</span> IPv4 주소는 약 43억 개의 고유 주소를 제공하나 현재 고갈 위기이다.

* **IPv6**
	128비트 주소 체계를 사용하며 **더 많은 수의 주소를 가질 수 있다.** 주소의 수가 충분하기 때문에 클래스 기반의 주소 구분을 사용하지 않는다. 주소는 8개의 16진수 그룹으로 표현되며 콜론으로 구분된다. (2001:0db8:85a3:0000:0000:8a2e:0370:7334)
	IPv6 주소는 다양한 유형의 주소가 존재한다.(유니캐스트, 멀티캐스트, 애니캐스트 등)
___
### IP 클래스

![[Pasted image 20231110165126.png]]

**ip는 그 수가 제한적이기 때문에 자원을 효율적으로 활용하기 위해서 네트워크 별로 각자의 성질에 알맞는 ip 주소를 활용한다.** 알파벳이 작아질 수록 네트워크에 포함 시킬 수 있는 호스트의 수가 많아지며 가격이 비싸진다.

| 클래스 | IP시작    | IP 끝           | 네트워크 바이트 | 호스트 바이트 |
| ------ | --------- | --------------- | --------------- | ------------- |
| A      | 0.0.0.0   | 127.255.255.255 | 1               | 3             |
| B      | 128.0.0.0 | 191.255.255.255 | 2               | 2             |
| C      | 192.0.0.0 | 239.255.255.255 | 3               | 1              |

___
### 서브네팅과 서브넷 마스크

**서브네팅은 네트워크 관리자가 ip주소 절약을 위해 하나의 주소에서 다시금 네트워크 영역과 호스트 영역을 분할하는 행위**이다. 이는 사설망을 구축할 때 자주 사용하는 기법으로 하나의 공인 ip 주소로 외부 접속을 받고 해당 ip를 분할해서 내부 사설망의 호스트들에 할당 해준다. 이때 **서브넷의 ip 주소를 획득하려면 기존 ip 주소에 특정한 연산을 수행해 이를 서브넷에서 사용하는 ip로 변환해야 하는데 이것이 서브넷 마스크**이다.

AWS의 VPC를 구축하다 보면 이를 직접 설정해 볼 수 있다. 아래의 이미지를 보자.

![[스크린샷 2023-12-22 오후 2.59.53.png]]

**192.168.0.0은 네트워크의 ip 주소이고 여기서 앞의 16비트를 네트워크 주소로 사용한다. 나머지 16비트는 호스트 영역이 된다.** B 클래스의 기본 서브넷 마스크를 적용해 사용하고 있는 것을 확인할 수 있다. 이에 따라 해당 서브넷의 패킷 중 ip가 192.168.~.~에 속하는 패킷은 사설망으로 라우팅하고 이외는 NAT로 라우팅한다.

이때 이상한 것이 있다. ip는 C클래스 서브넷 마스크는 B클래스의 형태를 사용하고 있다. 이게 어떻게 가능한 걸까? 이는 CIDR로 인해 가능하다.

* **CIDR**
	**CIDR 방식은 주소를 고정된 클래스로 나누지 않고, 네트워크 주소와 호스트 주소를 구분하는 서브넷 마스크를 사용하여 IP 주소 공간을 더 세밀하게 분할**한다. 서브넷 마스크를 활용해 '네트워크 부분'과 '호스트 부분'으로 나누기 때문에 네트워크를 클래스에 얽매이지 않고 자유롭게 분할 할 수 있다

| IP 주소    | 192.168.23.1  |
| -------------------- | -------------- |
| 서브넷 마스크  | 255.255.0.0 |
| 네트워크 주소  | 192.168.0.0  |
___
### 공인 IP와 사설 IP

* **공인 IP**
	공인 IP는 ISP가 제공하는 주소로 외부에 공개된 IP를 말한다. **이는 전세계에서 유일한 IP이기에 인터넷에 연결된 다른 호스트들도 해당 주소를 식별하는 것이 가능하다.** 공유기에 할당된 통신사 IP가 공인 IP이다. 

* **사설 IP**
	사설망 내부에 할당된 IP로 보안이나 IP 부족 현상으로 인해 사용한다. **외부에서 곧장 사설 IP에 접속하는 것은 불가하고 중간 장치를 거쳐야 한다.** 공유기를 통해 연결하는 장치들에 부여되는 IP가 사설 IP이다. 사설 IP는 외부에서 접속이 불가하기 때문에 사설망 내부에서 **인터넷을 연결하기 위해선 NAT를 사용해야만 한다.** (192.168.0~192.168.255.255) 대역을 자주 사용한다.

___
### ARP

주소 결정 프로토콜(Address Resolution Protocol)은 <span class= "red red-bg">IP 주소는 파악하고 있으나 상대의 MAC 주소를 파악하지 못하고 있을 때 사용한다.</span>  ARP는 MAC 주소 파악을 위해 LAN에 속한 구성원 전체에게 브로드캐스트 방식으로 패킷을 전달한다. 이때 ARP 요청을 수신한 호스트중 자신의 ip가 ARP요청과 일치하면 자신의 MAC 주소를 스위치로 전달한다. 전달된 MAC 주소는 스위치의 테이블에 기록돼  이후 전송에 활용된다.

![[Pasted image 20231111012342.png]]

* **ARP 스푸핑**
	ARP를 활용한 중간자 공격으로 MAC 주소를 속여 패킷을 훔치는 공격을 말한다. 공격자는 자신의 MAC 주소와 피해자의 ip 주소를 기록한 ARP 패킷을 전송하고 이에따라 수신은 피해자 ip에 해당하는 MAC주소가 공격자의 기기번호라 생각하고 전송하게 된다.